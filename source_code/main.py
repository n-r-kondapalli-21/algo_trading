# -*- coding: utf-8 -*-
"""
Created on Wed Aug 27 11:06:53 2025

@author: NARAYANA
"""

import time
from login import initialize_session, get_ticker_data
from get_index_expirydate_algo import get_expiry_date
from get_option_greeks_algo import indexGreeks
from get_final_strike_price_algo import final_strike_price
from index_name_formatting_algo import name_formatting
from transaction_cost_algo import transaction_cost_of_ticker,transaction_cost_on_HOLD
from cash_available_algo import available_cash
from profit_loss_algo import calculate_PL
from total_profit_loss_algo import calculate_tpl
from unrealized_PL_algo import calculate_unreal_PL
from MML_MMP_algo import update_MML_MMP
from buy_sell_qunatity_estimation_algo import decide_quantity
from delta_diff_algo import delta_diff
from buy_sell_action_algo import buy_sell_action
from data_base_algo import initialize_db, insert_trade
from trade_prices_algo import buy_sell_prices
import threading
import requests 
import socket



indexGreeks_response={'status': True, 'message': 'SUCCESS', 'errorcode': '', 'data': [{'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25000.000000', 'optionType': 'CE', 'delta': '0.464300', 'gamma': '0.000200', 'theta': '-14.210400', 'vega': '28.945800', 'impliedVolatility': '9.360000', 'tradeVolume': '31108.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25500.000000', 'optionType': 'CE', 'delta': '0.360400', 'gamma': '0.000200', 'theta': '-12.908900', 'vega': '27.262500', 'impliedVolatility': '9.490000', 'tradeVolume': '26469.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24500.000000', 'optionType': 'CE', 'delta': '0.572500', 'gamma': '0.000200', 'theta': '-14.730000', 'vega': '28.580500', 'impliedVolatility': '9.070000', 'tradeVolume': '25601.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26000.000000', 'optionType': 'CE', 'delta': '0.268200', 'gamma': '0.000200', 'theta': '-11.060800', 'vega': '24.005000', 'impliedVolatility': '10.100000', 'tradeVolume': '19948.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24700.000000', 'optionType': 'CE', 'delta': '0.529200', 'gamma': '0.000200', 'theta': '-14.623600', 'vega': '28.984500', 'impliedVolatility': '9.250000', 'tradeVolume': '17054.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25200.000000', 'optionType': 'CE', 'delta': '0.422000', 'gamma': '0.000200', 'theta': '-13.776700', 'vega': '28.504800', 'impliedVolatility': '9.300000', 'tradeVolume': '12243.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24800.000000', 'optionType': 'CE', 'delta': '0.507600', 'gamma': '0.000200', 'theta': '-14.519900', 'vega': '29.057500', 'impliedVolatility': '9.270000', 'tradeVolume': '11685.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24600.000000', 'optionType': 'CE', 'delta': '0.550900', 'gamma': '0.000200', 'theta': '-14.694000', 'vega': '28.825500', 'impliedVolatility': '9.180000', 'tradeVolume': '11527.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25300.000000', 'optionType': 'CE', 'delta': '0.401200', 'gamma': '0.000200', 'theta': '-13.515700', 'vega': '28.166400', 'impliedVolatility': '9.310000', 'tradeVolume': '11175.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25800.000000', 'optionType': 'CE', 'delta': '0.302700', 'gamma': '0.000200', 'theta': '-11.830600', 'vega': '25.424700', 'impliedVolatility': '9.750000', 'tradeVolume': '9459.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25700.000000', 'optionType': 'CE', 'delta': '0.322100', 'gamma': '0.000200', 'theta': '-12.226000', 'vega': '26.124100', 'impliedVolatility': '9.610000', 'tradeVolume': '8668.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25400.000000', 'optionType': 'CE', 'delta': '0.380800', 'gamma': '0.000200', 'theta': '-13.228200', 'vega': '27.754800', 'impliedVolatility': '9.340000', 'tradeVolume': '7334.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25100.000000', 'optionType': 'CE', 'delta': '0.442700', 'gamma': '0.000200', 'theta': '-14.004200', 'vega': '28.760000', 'impliedVolatility': '9.340000', 'tradeVolume': '6855.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25900.000000', 'optionType': 'CE', 'delta': '0.285600', 'gamma': '0.000200', 'theta': '-11.464500', 'vega': '24.758500', 'impliedVolatility': '9.830000', 'tradeVolume': '6825.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25600.000000', 'optionType': 'CE', 'delta': '0.341200', 'gamma': '0.000200', 'theta': '-12.580300', 'vega': '26.727300', 'impliedVolatility': '9.520000', 'tradeVolume': '6401.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24900.000000', 'optionType': 'CE', 'delta': '0.485900', 'gamma': '0.000200', 'theta': '-14.381500', 'vega': '29.044100', 'impliedVolatility': '9.300000', 'tradeVolume': '6148.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26500.000000', 'optionType': 'CE', 'delta': '0.190800', 'gamma': '0.000100', 'theta': '-8.941900', 'vega': '19.822000', 'impliedVolatility': '11.140000', 'tradeVolume': '5715.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27000.000000', 'optionType': 'CE', 'delta': '0.129900', 'gamma': '0.000100', 'theta': '-6.831000', 'vega': '15.399400', 'impliedVolatility': '12.620000', 'tradeVolume': '4501.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26200.000000', 'optionType': 'CE', 'delta': '0.235300', 'gamma': '0.000200', 'theta': '-10.229600', 'vega': '22.403800', 'impliedVolatility': '10.400000', 'tradeVolume': '4495.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24000.000000', 'optionType': 'CE', 'delta': '0.677500', 'gamma': '0.000200', 'theta': '-14.403900', 'vega': '26.135000', 'impliedVolatility': '7.380000', 'tradeVolume': '4057.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25350.000000', 'optionType': 'CE', 'delta': '0.390900', 'gamma': '0.000200', 'theta': '-13.374800', 'vega': '27.969000', 'impliedVolatility': '9.340000', 'tradeVolume': '3905.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26100.000000', 'optionType': 'CE', 'delta': '0.251500', 'gamma': '0.000200', 'theta': '-10.650300', 'vega': '23.221700', 'impliedVolatility': '10.210000', 'tradeVolume': '3518.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24550.000000', 'optionType': 'CE', 'delta': '0.561700', 'gamma': '0.000200', 'theta': '-14.716400', 'vega': '28.713600', 'impliedVolatility': '9.100000', 'tradeVolume': '2905.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24400.000000', 'optionType': 'CE', 'delta': '0.594000', 'gamma': '0.000200', 'theta': '-14.731300', 'vega': '28.251400', 'impliedVolatility': '9.040000', 'tradeVolume': '2520.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25050.000000', 'optionType': 'CE', 'delta': '0.453700', 'gamma': '0.000200', 'theta': '-14.113900', 'vega': '28.866300', 'impliedVolatility': '9.300000', 'tradeVolume': '2494.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26300.000000', 'optionType': 'CE', 'delta': '0.219800', 'gamma': '0.000200', 'theta': '-9.801000', 'vega': '21.556600', 'impliedVolatility': '10.700000', 'tradeVolume': '2055.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26150.000000', 'optionType': 'CE', 'delta': '0.243300', 'gamma': '0.000200', 'theta': '-10.441300', 'vega': '22.817300', 'impliedVolatility': '10.380000', 'tradeVolume': '1904.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23500.000000', 'optionType': 'CE', 'delta': '0.769600', 'gamma': '0.000200', 'theta': '-13.369500', 'vega': '22.129200', 'impliedVolatility': '0.000000', 'tradeVolume': '1653.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26400.000000', 'optionType': 'CE', 'delta': '0.204900', 'gamma': '0.000200', 'theta': '-9.370900', 'vega': '20.693700', 'impliedVolatility': '10.960000', 'tradeVolume': '1565.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25550.000000', 'optionType': 'CE', 'delta': '0.350900', 'gamma': '0.000200', 'theta': '-12.750800', 'vega': '27.008500', 'impliedVolatility': '9.460000', 'tradeVolume': '1468.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24850.000000', 'optionType': 'CE', 'delta': '0.496400', 'gamma': '0.000200', 'theta': '-14.451900', 'vega': '29.059500', 'impliedVolatility': '9.280000', 'tradeVolume': '1341.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24650.000000', 'optionType': 'CE', 'delta': '0.540000', 'gamma': '0.000200', 'theta': '-14.662800', 'vega': '28.915900', 'impliedVolatility': '9.280000', 'tradeVolume': '1256.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25250.000000', 'optionType': 'CE', 'delta': '0.411600', 'gamma': '0.000200', 'theta': '-13.650000', 'vega': '28.345600', 'impliedVolatility': '9.330000', 'tradeVolume': '1226.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24950.000000', 'optionType': 'CE', 'delta': '0.474800', 'gamma': '0.000200', 'theta': '-14.297100', 'vega': '29.002800', 'impliedVolatility': '9.350000', 'tradeVolume': '1212.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24450.000000', 'optionType': 'CE', 'delta': '0.581400', 'gamma': '0.000200', 'theta': '-14.729000', 'vega': '28.445600', 'impliedVolatility': '9.130000', 'tradeVolume': '1097.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25150.000000', 'optionType': 'CE', 'delta': '0.432500', 'gamma': '0.000200', 'theta': '-13.896500', 'vega': '28.645100', 'impliedVolatility': '9.340000', 'tradeVolume': '1019.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24200.000000', 'optionType': 'CE', 'delta': '0.635200', 'gamma': '0.000200', 'theta': '-14.633800', 'vega': '27.371500', 'impliedVolatility': '8.690000', 'tradeVolume': '903.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26700.000000', 'optionType': 'CE', 'delta': '0.164500', 'gamma': '0.000100', 'theta': '-8.082100', 'vega': '18.045100', 'impliedVolatility': '11.710000', 'tradeVolume': '893.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25450.000000', 'optionType': 'CE', 'delta': '0.370500', 'gamma': '0.000200', 'theta': '-13.071200', 'vega': '27.516700', 'impliedVolatility': '9.430000', 'tradeVolume': '881.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25650.000000', 'optionType': 'CE', 'delta': '0.330100', 'gamma': '0.000200', 'theta': '-12.373900', 'vega': '26.378400', 'impliedVolatility': '9.590000', 'tradeVolume': '869.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24300.000000', 'optionType': 'CE', 'delta': '0.613800', 'gamma': '0.000200', 'theta': '-14.697400', 'vega': '27.864800', 'impliedVolatility': '8.850000', 'tradeVolume': '730.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24750.000000', 'optionType': 'CE', 'delta': '0.518400', 'gamma': '0.000200', 'theta': '-14.576000', 'vega': '29.031600', 'impliedVolatility': '9.250000', 'tradeVolume': '681.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '29000.000000', 'optionType': 'CE', 'delta': '0.018000', 'gamma': '0.000000', 'theta': '-1.368100', 'vega': '3.215800', 'impliedVolatility': '19.710000', 'tradeVolume': '625.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '28000.000000', 'optionType': 'CE', 'delta': '0.052300', 'gamma': '0.000100', 'theta': '-3.370000', 'vega': '7.788600', 'impliedVolatility': '16.350000', 'tradeVolume': '587.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25750.000000', 'optionType': 'CE', 'delta': '0.310900', 'gamma': '0.000200', 'theta': '-11.997400', 'vega': '25.721600', 'impliedVolatility': '9.700000', 'tradeVolume': '578.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23000.000000', 'optionType': 'CE', 'delta': '0.848700', 'gamma': '0.000100', 'theta': '-11.830700', 'vega': '17.080600', 'impliedVolatility': '0.000000', 'tradeVolume': '569.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26600.000000', 'optionType': 'CE', 'delta': '0.177000', 'gamma': '0.000100', 'theta': '-8.499800', 'vega': '18.913200', 'impliedVolatility': '11.500000', 'tradeVolume': '530.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25950.000000', 'optionType': 'CE', 'delta': '0.276700', 'gamma': '0.000200', 'theta': '-11.259700', 'vega': '24.378300', 'impliedVolatility': '10.000000', 'tradeVolume': '483.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '30000.000000', 'optionType': 'CE', 'delta': '0.005400', 'gamma': '0.000000', 'theta': '-0.474200', 'vega': '1.128100', 'impliedVolatility': '23.090000', 'tradeVolume': '415.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26050.000000', 'optionType': 'CE', 'delta': '0.257900', 'gamma': '0.000200', 'theta': '-10.806000', 'vega': '23.520900', 'impliedVolatility': '10.250000', 'tradeVolume': '341.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25850.000000', 'optionType': 'CE', 'delta': '0.293200', 'gamma': '0.000200', 'theta': '-11.627600', 'vega': '25.057600', 'impliedVolatility': '9.840000', 'tradeVolume': '336.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27400.000000', 'optionType': 'CE', 'delta': '0.092900', 'gamma': '0.000100', 'theta': '-5.315300', 'vega': '12.116700', 'impliedVolatility': '14.010000', 'tradeVolume': '262.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26250.000000', 'optionType': 'CE', 'delta': '0.225000', 'gamma': '0.000200', 'theta': '-9.941000', 'vega': '21.835200', 'impliedVolatility': '10.650000', 'tradeVolume': '260.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26800.000000', 'optionType': 'CE', 'delta': '0.154800', 'gamma': '0.000100', 'theta': '-7.750600', 'vega': '17.356500', 'impliedVolatility': '11.970000', 'tradeVolume': '233.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26550.000000', 'optionType': 'CE', 'delta': '0.183000', 'gamma': '0.000100', 'theta': '-8.692200', 'vega': '19.310100', 'impliedVolatility': '11.370000', 'tradeVolume': '224.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27100.000000', 'optionType': 'CE', 'delta': '0.119100', 'gamma': '0.000100', 'theta': '-6.406500', 'vega': '14.489300', 'impliedVolatility': '13.040000', 'tradeVolume': '190.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22000.000000', 'optionType': 'CE', 'delta': '0.948500', 'gamma': '0.000100', 'theta': '-8.608400', 'vega': '7.691700', 'impliedVolatility': '0.000000', 'tradeVolume': '174.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24100.000000', 'optionType': 'CE', 'delta': '0.655000', 'gamma': '0.000200', 'theta': '-14.538900', 'vega': '26.828400', 'impliedVolatility': '8.380000', 'tradeVolume': '168.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26750.000000', 'optionType': 'CE', 'delta': '0.157400', 'gamma': '0.000100', 'theta': '-7.834600', 'vega': '17.528800', 'impliedVolatility': '11.940000', 'tradeVolume': '152.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27300.000000', 'optionType': 'CE', 'delta': '0.101000', 'gamma': '0.000100', 'theta': '-5.665200', 'vega': '12.879300', 'impliedVolatility': '13.500000', 'tradeVolume': '150.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27200.000000', 'optionType': 'CE', 'delta': '0.110300', 'gamma': '0.000100', 'theta': '-6.054000', 'vega': '13.728300', 'impliedVolatility': '13.350000', 'tradeVolume': '144.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27150.000000', 'optionType': 'CE', 'delta': '0.116600', 'gamma': '0.000100', 'theta': '-6.314900', 'vega': '14.296000', 'impliedVolatility': '13.040000', 'tradeVolume': '142.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26350.000000', 'optionType': 'CE', 'delta': '0.212300', 'gamma': '0.000200', 'theta': '-9.587700', 'vega': '21.130300', 'impliedVolatility': '10.830000', 'tradeVolume': '142.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '21000.000000', 'optionType': 'CE', 'delta': '0.988200', 'gamma': '0.000000', 'theta': '-6.494900', 'vega': '2.248100', 'impliedVolatility': '0.000000', 'tradeVolume': '136.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24350.000000', 'optionType': 'CE', 'delta': '0.606300', 'gamma': '0.000200', 'theta': '-14.719600', 'vega': '28.036800', 'impliedVolatility': '8.940000', 'tradeVolume': '134.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26450.000000', 'optionType': 'CE', 'delta': '0.200100', 'gamma': '0.000200', 'theta': '-9.228200', 'vega': '20.427100', 'impliedVolatility': '11.080000', 'tradeVolume': '111.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27350.000000', 'optionType': 'CE', 'delta': '0.098400', 'gamma': '0.000100', 'theta': '-5.558200', 'vega': '12.650800', 'impliedVolatility': '13.780000', 'tradeVolume': '76.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23800.000000', 'optionType': 'CE', 'delta': '0.718100', 'gamma': '0.000200', 'theta': '-14.043500', 'vega': '24.621200', 'impliedVolatility': '0.000000', 'tradeVolume': '74.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24250.000000', 'optionType': 'CE', 'delta': '0.624100', 'gamma': '0.000200', 'theta': '-14.663100', 'vega': '27.651600', 'impliedVolatility': '9.000000', 'tradeVolume': '68.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26900.000000', 'optionType': 'CE', 'delta': '0.139300', 'gamma': '0.000100', 'theta': '-7.184500', 'vega': '16.154200', 'impliedVolatility': '12.380000', 'tradeVolume': '57.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23900.000000', 'optionType': 'CE', 'delta': '0.700100', 'gamma': '0.000200', 'theta': '-14.224300', 'vega': '25.347300', 'impliedVolatility': '6.750000', 'tradeVolume': '48.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26650.000000', 'optionType': 'CE', 'delta': '0.173900', 'gamma': '0.000100', 'theta': '-8.406500', 'vega': '18.726900', 'impliedVolatility': '11.550000', 'tradeVolume': '37.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23600.000000', 'optionType': 'CE', 'delta': '0.743900', 'gamma': '0.000200', 'theta': '-13.694700', 'vega': '23.423900', 'impliedVolatility': '0.000000', 'tradeVolume': '31.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26950.000000', 'optionType': 'CE', 'delta': '0.133500', 'gamma': '0.000100', 'theta': '-6.963700', 'vega': '15.683800', 'impliedVolatility': '12.600000', 'tradeVolume': '23.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26850.000000', 'optionType': 'CE', 'delta': '0.145600', 'gamma': '0.000100', 'theta': '-7.417700', 'vega': '16.650200', 'impliedVolatility': '12.280000', 'tradeVolume': '22.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27250.000000', 'optionType': 'CE', 'delta': '0.106700', 'gamma': '0.000100', 'theta': '-5.904800', 'vega': '13.411100', 'impliedVolatility': '13.450000', 'tradeVolume': '14.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22800.000000', 'optionType': 'CE', 'delta': '0.876400', 'gamma': '0.000100', 'theta': '-11.115800', 'vega': '14.889100', 'impliedVolatility': '0.000000', 'tradeVolume': '13.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23700.000000', 'optionType': 'CE', 'delta': '0.739700', 'gamma': '0.000200', 'theta': '-13.804500', 'vega': '23.671000', 'impliedVolatility': '0.000000', 'tradeVolume': '9.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '20000.000000', 'optionType': 'CE', 'delta': '0.998200', 'gamma': '0.000000', 'theta': '-5.578800', 'vega': '0.410000', 'impliedVolatility': '0.000000', 'tradeVolume': '9.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23400.000000', 'optionType': 'CE', 'delta': '0.788600', 'gamma': '0.000200', 'theta': '-13.061100', 'vega': '21.098300', 'impliedVolatility': '0.000000', 'tradeVolume': '6.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23200.000000', 'optionType': 'CE', 'delta': '0.820700', 'gamma': '0.000100', 'theta': '-12.454300', 'vega': '19.088300', 'impliedVolatility': '0.000000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24150.000000', 'optionType': 'CE', 'delta': '0.642400', 'gamma': '0.000200', 'theta': '-14.586400', 'vega': '27.187300', 'impliedVolatility': '8.580000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23300.000000', 'optionType': 'CE', 'delta': '0.799800', 'gamma': '0.000200', 'theta': '-12.842000', 'vega': '20.401700', 'impliedVolatility': '0.000000', 'tradeVolume': '2.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27050.000000', 'optionType': 'CE', 'delta': '0.126600', 'gamma': '0.000100', 'theta': '-6.707100', 'vega': '15.143300', 'impliedVolatility': '12.810000', 'tradeVolume': '2.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '17000.000000', 'optionType': 'CE', 'delta': '1.000000', 'gamma': '0.000000', 'theta': '-4.616600', 'vega': '0.000100', 'impliedVolatility': '0.000000', 'tradeVolume': '1.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24050.000000', 'optionType': 'CE', 'delta': '0.667500', 'gamma': '0.000200', 'theta': '-14.465400', 'vega': '26.480800', 'impliedVolatility': '8.600000', 'tradeVolume': '1.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24500.000000', 'optionType': 'PE', 'delta': '-0.427400', 'gamma': '0.000200', 'theta': '-8.076500', 'vega': '28.580400', 'impliedVolatility': '12.030000', 'tradeVolume': '37132.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24000.000000', 'optionType': 'PE', 'delta': '-0.322500', 'gamma': '0.000200', 'theta': '-7.886100', 'vega': '26.134700', 'impliedVolatility': '12.520000', 'tradeVolume': '35545.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23500.000000', 'optionType': 'PE', 'delta': '-0.228300', 'gamma': '0.000200', 'theta': '-6.962400', 'vega': '22.025800', 'impliedVolatility': '13.390000', 'tradeVolume': '14339.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24600.000000', 'optionType': 'PE', 'delta': '-0.449100', 'gamma': '0.000200', 'theta': '-8.013500', 'vega': '28.825400', 'impliedVolatility': '11.980000', 'tradeVolume': '14290.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24700.000000', 'optionType': 'PE', 'delta': '-0.471100', 'gamma': '0.000200', 'theta': '-7.914100', 'vega': '28.984500', 'impliedVolatility': '11.900000', 'tradeVolume': '13073.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23000.000000', 'optionType': 'PE', 'delta': '-0.150500', 'gamma': '0.000100', 'theta': '-5.567500', 'vega': '17.021300', 'impliedVolatility': '14.710000', 'tradeVolume': '11932.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24300.000000', 'optionType': 'PE', 'delta': '-0.384700', 'gamma': '0.000200', 'theta': '-8.099500', 'vega': '27.839100', 'impliedVolatility': '12.090000', 'tradeVolume': '8991.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24200.000000', 'optionType': 'PE', 'delta': '-0.363600', 'gamma': '0.000200', 'theta': '-8.060600', 'vega': '27.347300', 'impliedVolatility': '12.160000', 'tradeVolume': '8839.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24400.000000', 'optionType': 'PE', 'delta': '-0.405900', 'gamma': '0.000200', 'theta': '-8.105100', 'vega': '28.250800', 'impliedVolatility': '12.030000', 'tradeVolume': '8466.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25000.000000', 'optionType': 'PE', 'delta': '-0.535700', 'gamma': '0.000200', 'theta': '-7.421200', 'vega': '28.945800', 'impliedVolatility': '12.140000', 'tradeVolume': '8119.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23800.000000', 'optionType': 'PE', 'delta': '-0.283100', 'gamma': '0.000200', 'theta': '-7.592700', 'vega': '24.654200', 'impliedVolatility': '12.780000', 'tradeVolume': '8044.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23900.000000', 'optionType': 'PE', 'delta': '-0.302500', 'gamma': '0.000200', 'theta': '-7.753500', 'vega': '25.425600', 'impliedVolatility': '12.630000', 'tradeVolume': '6199.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24100.000000', 'optionType': 'PE', 'delta': '-0.342800', 'gamma': '0.000200', 'theta': '-7.988900', 'vega': '26.776000', 'impliedVolatility': '12.300000', 'tradeVolume': '5838.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22000.000000', 'optionType': 'PE', 'delta': '-0.051700', 'gamma': '0.000100', 'theta': '-2.642000', 'vega': '7.716500', 'impliedVolatility': '18.840000', 'tradeVolume': '5687.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24550.000000', 'optionType': 'PE', 'delta': '-0.438300', 'gamma': '0.000200', 'theta': '-8.049100', 'vega': '28.713900', 'impliedVolatility': '11.950000', 'tradeVolume': '5402.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24800.000000', 'optionType': 'PE', 'delta': '-0.492500', 'gamma': '0.000200', 'theta': '-7.784500', 'vega': '29.057200', 'impliedVolatility': '11.940000', 'tradeVolume': '5315.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23700.000000', 'optionType': 'PE', 'delta': '-0.264200', 'gamma': '0.000200', 'theta': '-7.405500', 'vega': '23.824700', 'impliedVolatility': '12.990000', 'tradeVolume': '4416.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23600.000000', 'optionType': 'PE', 'delta': '-0.246000', 'gamma': '0.000200', 'theta': '-7.195400', 'vega': '22.949600', 'impliedVolatility': '13.180000', 'tradeVolume': '4054.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24450.000000', 'optionType': 'PE', 'delta': '-0.418000', 'gamma': '0.000200', 'theta': '-8.091000', 'vega': '28.439600', 'impliedVolatility': '12.050000', 'tradeVolume': '2747.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24650.000000', 'optionType': 'PE', 'delta': '-0.460400', 'gamma': '0.000200', 'theta': '-7.966200', 'vega': '28.916700', 'impliedVolatility': '11.950000', 'tradeVolume': '2734.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23300.000000', 'optionType': 'PE', 'delta': '-0.195300', 'gamma': '0.000200', 'theta': '-6.448200', 'vega': '20.100900', 'impliedVolatility': '13.850000', 'tradeVolume': '2531.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25100.000000', 'optionType': 'PE', 'delta': '-0.557000', 'gamma': '0.000200', 'theta': '-7.192100', 'vega': '28.765200', 'impliedVolatility': '12.410000', 'tradeVolume': '2470.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22600.000000', 'optionType': 'PE', 'delta': '-0.102600', 'gamma': '0.000100', 'theta': '-4.349800', 'vega': '13.023900', 'impliedVolatility': '16.100000', 'tradeVolume': '1943.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23400.000000', 'optionType': 'PE', 'delta': '-0.211500', 'gamma': '0.000200', 'theta': '-6.714200', 'vega': '21.080800', 'impliedVolatility': '13.630000', 'tradeVolume': '1800.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25500.000000', 'optionType': 'PE', 'delta': '-0.639200', 'gamma': '0.000200', 'theta': '-5.991100', 'vega': '27.274300', 'impliedVolatility': '13.590000', 'tradeVolume': '1631.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23200.000000', 'optionType': 'PE', 'delta': '-0.180700', 'gamma': '0.000100', 'theta': '-6.183800', 'vega': '19.154700', 'impliedVolatility': '14.120000', 'tradeVolume': '1579.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25200.000000', 'optionType': 'PE', 'delta': '-0.579500', 'gamma': '0.000200', 'theta': '-6.911800', 'vega': '28.476400', 'impliedVolatility': '12.500000', 'tradeVolume': '1466.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24900.000000', 'optionType': 'PE', 'delta': '-0.516200', 'gamma': '0.000200', 'theta': '-7.598900', 'vega': '29.027600', 'impliedVolatility': '12.070000', 'tradeVolume': '1420.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22800.000000', 'optionType': 'PE', 'delta': '-0.125500', 'gamma': '0.000100', 'theta': '-4.969900', 'vega': '15.031600', 'impliedVolatility': '15.380000', 'tradeVolume': '1209.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23050.000000', 'optionType': 'PE', 'delta': '-0.158400', 'gamma': '0.000100', 'theta': '-5.737500', 'vega': '17.601400', 'impliedVolatility': '14.530000', 'tradeVolume': '1190.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '21000.000000', 'optionType': 'PE', 'delta': '-0.012000', 'gamma': '0.000000', 'theta': '-0.799400', 'vega': '2.267700', 'impliedVolatility': '22.920000', 'tradeVolume': '1082.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23850.000000', 'optionType': 'PE', 'delta': '-0.294600', 'gamma': '0.000200', 'theta': '-7.688200', 'vega': '25.109200', 'impliedVolatility': '12.750000', 'tradeVolume': '955.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22700.000000', 'optionType': 'PE', 'delta': '-0.112900', 'gamma': '0.000100', 'theta': '-4.639500', 'vega': '13.954100', 'impliedVolatility': '15.690000', 'tradeVolume': '900.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23100.000000', 'optionType': 'PE', 'delta': '-0.165800', 'gamma': '0.000100', 'theta': '-5.892100', 'vega': '18.133900', 'impliedVolatility': '14.380000', 'tradeVolume': '893.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24350.000000', 'optionType': 'PE', 'delta': '-0.395300', 'gamma': '0.000200', 'theta': '-8.106500', 'vega': '28.055300', 'impliedVolatility': '12.070000', 'tradeVolume': '870.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26000.000000', 'optionType': 'PE', 'delta': '-0.733400', 'gamma': '0.000200', 'theta': '-3.958700', 'vega': '23.926300', 'impliedVolatility': '16.200000', 'tradeVolume': '861.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24150.000000', 'optionType': 'PE', 'delta': '-0.353400', 'gamma': '0.000200', 'theta': '-8.029200', 'vega': '27.076300', 'impliedVolatility': '12.270000', 'tradeVolume': '824.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23950.000000', 'optionType': 'PE', 'delta': '-0.312400', 'gamma': '0.000200', 'theta': '-7.823300', 'vega': '25.787500', 'impliedVolatility': '12.560000', 'tradeVolume': '710.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24050.000000', 'optionType': 'PE', 'delta': '-0.332600', 'gamma': '0.000200', 'theta': '-7.941400', 'vega': '26.464300', 'impliedVolatility': '12.440000', 'tradeVolume': '587.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22650.000000', 'optionType': 'PE', 'delta': '-0.107400', 'gamma': '0.000100', 'theta': '-4.488500', 'vega': '13.467700', 'impliedVolatility': '15.930000', 'tradeVolume': '571.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24250.000000', 'optionType': 'PE', 'delta': '-0.376700', 'gamma': '0.000200', 'theta': '-8.084100', 'vega': '27.650800', 'impliedVolatility': '12.210000', 'tradeVolume': '567.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24750.000000', 'optionType': 'PE', 'delta': '-0.482300', 'gamma': '0.000200', 'theta': '-7.849500', 'vega': '29.030300', 'impliedVolatility': '11.950000', 'tradeVolume': '461.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '20000.000000', 'optionType': 'PE', 'delta': '-0.001800', 'gamma': '0.000000', 'theta': '-0.149500', 'vega': '0.415800', 'impliedVolatility': '28.440000', 'tradeVolume': '438.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26500.000000', 'optionType': 'PE', 'delta': '-0.809900', 'gamma': '0.000100', 'theta': '-1.721100', 'vega': '19.772600', 'impliedVolatility': '19.490000', 'tradeVolume': '390.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27000.000000', 'optionType': 'PE', 'delta': '-0.870900', 'gamma': '0.000100', 'theta': '0.531500', 'vega': '15.335600', 'impliedVolatility': '22.840000', 'tradeVolume': '388.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22900.000000', 'optionType': 'PE', 'delta': '-0.138400', 'gamma': '0.000100', 'theta': '-5.287300', 'vega': '16.081700', 'impliedVolatility': '15.020000', 'tradeVolume': '371.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '17000.000000', 'optionType': 'PE', 'delta': '0.000000', 'gamma': '0.000000', 'theta': '0.000000', 'vega': '0.000100', 'impliedVolatility': '45.700000', 'tradeVolume': '360.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25300.000000', 'optionType': 'PE', 'delta': '-0.598900', 'gamma': '0.000200', 'theta': '-6.643300', 'vega': '28.163900', 'impliedVolatility': '12.460000', 'tradeVolume': '343.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23350.000000', 'optionType': 'PE', 'delta': '-0.204400', 'gamma': '0.000200', 'theta': '-6.599800', 'vega': '20.657200', 'impliedVolatility': '13.790000', 'tradeVolume': '324.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23750.000000', 'optionType': 'PE', 'delta': '-0.273800', 'gamma': '0.000200', 'theta': '-7.503900', 'vega': '24.253600', 'impliedVolatility': '12.870000', 'tradeVolume': '317.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24950.000000', 'optionType': 'PE', 'delta': '-0.526200', 'gamma': '0.000200', 'theta': '-7.510800', 'vega': '28.992900', 'impliedVolatility': '12.110000', 'tradeVolume': '299.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23650.000000', 'optionType': 'PE', 'delta': '-0.257600', 'gamma': '0.000200', 'theta': '-7.328100', 'vega': '23.503300', 'impliedVolatility': '13.090000', 'tradeVolume': '292.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23550.000000', 'optionType': 'PE', 'delta': '-0.237000', 'gamma': '0.000200', 'theta': '-7.081200', 'vega': '22.491500', 'impliedVolatility': '13.280000', 'tradeVolume': '268.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '24850.000000', 'optionType': 'PE', 'delta': '-0.503300', 'gamma': '0.000200', 'theta': '-7.706400', 'vega': '29.061600', 'impliedVolatility': '11.980000', 'tradeVolume': '238.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22950.000000', 'optionType': 'PE', 'delta': '-0.143300', 'gamma': '0.000100', 'theta': '-5.404000', 'vega': '16.474500', 'impliedVolatility': '14.930000', 'tradeVolume': '197.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25400.000000', 'optionType': 'PE', 'delta': '-0.621300', 'gamma': '0.000200', 'theta': '-6.294200', 'vega': '27.698100', 'impliedVolatility': '13.080000', 'tradeVolume': '196.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23450.000000', 'optionType': 'PE', 'delta': '-0.221400', 'gamma': '0.000200', 'theta': '-6.860500', 'vega': '21.638600', 'impliedVolatility': '13.550000', 'tradeVolume': '183.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23250.000000', 'optionType': 'PE', 'delta': '-0.188400', 'gamma': '0.000100', 'theta': '-6.324700', 'vega': '19.656600', 'impliedVolatility': '14.020000', 'tradeVolume': '181.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '28000.000000', 'optionType': 'PE', 'delta': '-0.946000', 'gamma': '0.000100', 'theta': '4.141800', 'vega': '7.998700', 'impliedVolatility': '28.900000', 'tradeVolume': '175.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22850.000000', 'optionType': 'PE', 'delta': '-0.132600', 'gamma': '0.000100', 'theta': '-5.145600', 'vega': '15.611900', 'impliedVolatility': '15.190000', 'tradeVolume': '137.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '19000.000000', 'optionType': 'PE', 'delta': '-0.000200', 'gamma': '0.000000', 'theta': '-0.015900', 'vega': '0.043800', 'impliedVolatility': '34.260000', 'tradeVolume': '126.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '22750.000000', 'optionType': 'PE', 'delta': '-0.119600', 'gamma': '0.000100', 'theta': '-4.817200', 'vega': '14.533300', 'impliedVolatility': '15.580000', 'tradeVolume': '105.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '23150.000000', 'optionType': 'PE', 'delta': '-0.173300', 'gamma': '0.000100', 'theta': '-6.041600', 'vega': '18.655100', 'impliedVolatility': '14.270000', 'tradeVolume': '88.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25700.000000', 'optionType': 'PE', 'delta': '-0.678300', 'gamma': '0.000200', 'theta': '-5.237100', 'vega': '26.107300', 'impliedVolatility': '14.010000', 'tradeVolume': '79.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '29000.000000', 'optionType': 'PE', 'delta': '-0.981800', 'gamma': '0.000000', 'theta': '6.494500', 'vega': '3.248300', 'impliedVolatility': '35.370000', 'tradeVolume': '74.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '18000.000000', 'optionType': 'PE', 'delta': '0.000000', 'gamma': '0.000000', 'theta': '-0.000900', 'vega': '0.002500', 'impliedVolatility': '39.730000', 'tradeVolume': '59.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25050.000000', 'optionType': 'PE', 'delta': '-0.545500', 'gamma': '0.000200', 'theta': '-7.316000', 'vega': '28.888900', 'impliedVolatility': '12.040000', 'tradeVolume': '54.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25800.000000', 'optionType': 'PE', 'delta': '-0.708200', 'gamma': '0.000200', 'theta': '-4.551800', 'vega': '24.971500', 'impliedVolatility': '15.310000', 'tradeVolume': '48.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25600.000000', 'optionType': 'PE', 'delta': '-0.656100', 'gamma': '0.000200', 'theta': '-5.681300', 'vega': '26.830500', 'impliedVolatility': '13.470000', 'tradeVolume': '27.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25450.000000', 'optionType': 'PE', 'delta': '-0.629700', 'gamma': '0.000200', 'theta': '-6.155400', 'vega': '27.509800', 'impliedVolatility': '13.220000', 'tradeVolume': '11.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25250.000000', 'optionType': 'PE', 'delta': '-0.589700', 'gamma': '0.000200', 'theta': '-6.763300', 'vega': '28.340800', 'impliedVolatility': '12.520000', 'tradeVolume': '10.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25150.000000', 'optionType': 'PE', 'delta': '-0.571900', 'gamma': '0.000200', 'theta': '-6.996900', 'vega': '28.586200', 'impliedVolatility': '12.200000', 'tradeVolume': '10.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25900.000000', 'optionType': 'PE', 'delta': '-0.713900', 'gamma': '0.000200', 'theta': '-4.432200', 'vega': '24.798800', 'impliedVolatility': '15.080000', 'tradeVolume': '9.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26200.000000', 'optionType': 'PE', 'delta': '-0.765500', 'gamma': '0.000200', 'theta': '-3.089700', 'vega': '22.355000', 'impliedVolatility': '17.310000', 'tradeVolume': '8.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25550.000000', 'optionType': 'PE', 'delta': '-0.645400', 'gamma': '0.000200', 'theta': '-5.880800', 'vega': '27.135000', 'impliedVolatility': '13.570000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26600.000000', 'optionType': 'PE', 'delta': '-0.823700', 'gamma': '0.000100', 'theta': '-1.235800', 'vega': '18.889100', 'impliedVolatility': '18.690000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26800.000000', 'optionType': 'PE', 'delta': '-0.855000', 'gamma': '0.000100', 'theta': '-0.087900', 'vega': '16.585300', 'impliedVolatility': '21.750000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26450.000000', 'optionType': 'PE', 'delta': '-0.808400', 'gamma': '0.000100', 'theta': '-1.754200', 'vega': '19.859800', 'impliedVolatility': '19.460000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25650.000000', 'optionType': 'PE', 'delta': '-0.683500', 'gamma': '0.000200', 'theta': '-5.097200', 'vega': '25.879600', 'impliedVolatility': '14.130000', 'tradeVolume': '4.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '25350.000000', 'optionType': 'PE', 'delta': '-0.610600', 'gamma': '0.000200', 'theta': '-6.457300', 'vega': '27.948700', 'impliedVolatility': '12.560000', 'tradeVolume': '3.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26100.000000', 'optionType': 'PE', 'delta': '-0.748000', 'gamma': '0.000200', 'theta': '-3.570500', 'vega': '23.259400', 'impliedVolatility': '16.490000', 'tradeVolume': '3.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '26300.000000', 'optionType': 'PE', 'delta': '-0.782200', 'gamma': '0.000200', 'theta': '-2.587900', 'vega': '21.450800', 'impliedVolatility': '17.770000', 'tradeVolume': '2.00'}, {'name': 'NIFTY', 'expiry': '30SEP2025', 'strikePrice': '27300.000000', 'optionType': 'PE', 'delta': '-0.904200', 'gamma': '0.000100', 'theta': '1.991200', 'vega': '12.381000', 'impliedVolatility': '28.460000', 'tradeVolume': '1.00'}]}
TABLE_NAME = "NIFTY_trades_" + time.strftime("%Y_%m_%d_%H_%M_%S")
buy_sell_quantity=75


def trade_cycle(session, ticker_data, ticker_name="NIFTY"):
    """
function_name: trade_cycle

Parameters:
    session : SmartConnect
        Active trading API session object used to fetch market data and place trades.
    ticker_data : DataFrame
        Instrument list or ticker details used to extract strike and token information.
    ticker_name : str, optional (default="NIFTY")
        Name of the index or ticker symbol to trade on.

Returns:
    None
        Executes a complete trade cycle by:
        - Fetching expiry, option greeks, strike details, and LTP.
        - Deciding buy/sell/hold action and trade quantity.
        - Calculating transaction cost, profit/loss, TPL, unrealized PL.
        - Updating margin levels (MML, MMP) and delta difference (DD).
        - Inserting trade details into the database table.
"""


    expiry_date, index_ltp, future_ltp = get_expiry_date(session, ticker_data, ticker_name)
    # indexGreeks_response = indexGreeks(session, expiry_date)

    strike_price, option_type, delta, gamma, theta, vega, IV, volume = final_strike_price(indexGreeks_response, index_ltp)
    formatted_index_symbol, index_token, lotsize, ltp, openinterest = name_formatting(session, ticker_data, ticker_name, expiry_date, strike_price, option_type)

    b_s_quantity = decide_quantity(buy_sell_quantity, int(lotsize))
    sno, time_stamp, action = buy_sell_action(buy_sell_quantity, float(delta))

    buy_price, sell_price = buy_sell_prices(action, ltp)
    
    transaction_cost_db=transaction_cost_on_HOLD(session, action, buy_sell_quantity, buy_price, sell_price, ticker_name, index_token, "NFO")

    transaction_cost = transaction_cost_of_ticker(session, action, buy_sell_quantity, buy_price, sell_price, ticker_name, index_token, "NFO",ltp)
    Profit_loss = calculate_PL(buy_price, sell_price, buy_sell_quantity, transaction_cost, action)
    total_profit_loss = calculate_tpl(Profit_loss)

    cash_available = available_cash(session)
    unrealized_PL = calculate_unreal_PL(buy_price, ltp, buy_sell_quantity, transaction_cost, action)
    mml, mmp = update_MML_MMP(unrealized_PL)
    DD = delta_diff(delta)

    rows = {
        "S_no": sno, "SYMBOL": formatted_index_symbol, "Ts": time_stamp,
        "B_S_Quant": b_s_quantity, "Tc": transaction_cost_db, "PL": Profit_loss,
        "unrealized_PL": unrealized_PL, "Td": action, "TPL": total_profit_loss,
        "delta": delta, "gamma": gamma, "theta": theta, "vega": vega,
        "IV": IV, "volume": volume, "cash": cash_available, "OI": openinterest,
        "FUTURE_LTP": future_ltp, "INDEX_LTP": index_ltp, "MML": mml,
        "MMP": mmp, "DD": DD
    }

    insert_trade(rows, TABLE_NAME)

    if action == "SELL":
        time.sleep(5)







stop_event = threading.Event()

def internet_available(host="8.8.8.8", port=53, timeout=3):
    """Check internet connectivity by connecting to Google DNS."""
    try:
        socket.setdefaulttimeout(timeout)
        socket.socket(socket.AF_INET, socket.SOCK_STREAM).connect((host, port))
        return True
    except socket.error:
        return False

def main_loop():
    while not stop_event.is_set():
        try:
            # Wait until internet is available before trying login
            while not internet_available() and not stop_event.is_set():
                print("[No Internet] Waiting for connection...")
                time.sleep(10)

            # Initialize session + setup
            session, logindata = initialize_session()
            ticker_data = get_ticker_data()
            initialize_db(TABLE_NAME)

            print("[Info] Trading session initialized.")

            while not stop_event.is_set():
                try:
                    trade_cycle(session, ticker_data, "NIFTY")

                except requests.exceptions.ReadTimeout as e:
                    print(f"[Timeout Error] {e}. Retrying in 10s...")
                    time.sleep(10)
                    break  # re-login in outer loop

                except requests.exceptions.ConnectionError as e:
                    print(f"[Connection Error] {e}. Retrying in 20s...")
                    time.sleep(20)
                    break  # re-login in outer loop

                except Exception as e:
                    print(f"[Trade Error] {e}. Retrying in 5s...")
                    time.sleep(5)

                time.sleep(5)

        except Exception as e:
            print(f"[Init Error] {e}. Retrying in 15s...")
            time.sleep(15)

# Run trading loop in a separate thread
threadws = threading.Thread(target=main_loop, daemon=True)
threadws.start()

# Keep main thread alive and allow CTRL+C to stop
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    print("\nStopping...")
    stop_event.set()
    threadws.join()




	
